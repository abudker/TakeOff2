---
phase: 06-automated-improvement-loop
plan: 03
type: execute
wave: 3
depends_on: ["06-02"]
files_modified: []
autonomous: false

must_haves:
  truths:
    - "Automated loop runs end-to-end without user interaction"
    - "Loop correctly stops on target F1 or plateau"
    - "History persists and resume works from any iteration"
    - "System progresses toward 0.90 F1 target"
  artifacts: []
  key_links: []
---

<objective>
End-to-end verification of automated improvement loop

Purpose: Verify the complete automated improvement loop works: runs iterations automatically, stops correctly on target/plateau/max, persists history, and enables resume from any iteration.

Output: Verified working automated improvement loop ready for F1 target pursuit.
</objective>

<execution_context>
@/Users/Andrew/.claude/get-shit-done/workflows/execute-plan.md
@/Users/Andrew/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/06-automated-improvement-loop/06-01-SUMMARY.md
@.planning/phases/06-automated-improvement-loop/06-02-SUMMARY.md
@src/improvement/cli.py
@src/improvement/loop.py
@src/improvement/history.py
</context>

<tasks>

<task type="auto">
  <name>Task 1: Run Short Automated Loop Test</name>
  <files></files>
  <action>
Run a short automated loop test to verify end-to-end functionality.

**Test procedure:**
1. Clear any existing history file: `rm -f .improvement-history.json`
2. Run loop with conservative limits: `python3 -m improvement loop --max-iterations 3 --patience 2 --no-commit`
3. Verify:
   - Loop runs without errors
   - Each iteration shows progress output
   - History file is created
   - Loop stops at max iterations (or earlier if plateau/target)

**Expected output:**
- Initial state panel showing current F1 and target
- Progress through iterations with metrics after each
- Final summary with stop reason

**If loop fails:**
- Check subprocess calls succeed (extraction, verification)
- Check critic invocation returns valid proposal
- Check proposal parsing handles all response formats
- Fix any issues before proceeding

Note: This test runs the real improvement loop, so it will invoke the critic agent and modify instruction files. Use --no-commit to avoid cluttering git history during testing.
  </action>
  <verify>
```bash
# Verify history file was created with iterations
cat .improvement-history.json | python3 -c "import json, sys; h=json.load(sys.stdin); print(f'Iterations recorded: {len(h.get(\"iterations\", []))}')"
```
  </verify>
  <done>Automated loop runs end-to-end, creates history file, shows progress, stops correctly</done>
</task>

<task type="auto">
  <name>Task 2: Verify History and Resume</name>
  <files></files>
  <action>
Verify history command and resume functionality work correctly.

**Test history command:**
```bash
python3 -m improvement history
# Should show iterations from Task 1

python3 -m improvement history --json
# Should output JSON

python3 -m improvement history --last 2
# Should show only last 2 iterations
```

**Test resume functionality:**
```bash
# Resume from iteration 1 (will re-run iterations 2+)
python3 -m improvement loop --resume-from 1 --max-iterations 2 --no-commit

# Verify history was truncated and new iterations added
python3 -m improvement history
```

**Verify:**
- History displays correctly with Rich table
- --json outputs valid JSON
- --resume-from truncates history to specified iteration
- Loop continues from resume point correctly
  </action>
  <verify>
```bash
# Check history shows expected structure
python3 -m improvement history 2>&1 | grep -E "(Iter|F1|Best)" || echo "History displayed"
```
  </verify>
  <done>History command displays iteration table, --json outputs JSON, resume correctly truncates and continues</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
Complete automated improvement loop system:
- ImprovementLoop class with stop conditions (target F1, plateau, max iterations)
- IterationHistory for persistence and querying
- CLI commands: loop, history
- Rich progress display during loop execution
  </what-built>
  <how-to-verify>
1. Run: `python3 -m improvement history` - should show iterations from test
2. Run: `python3 -m improvement loop --help` - verify all options documented
3. Review .improvement-history.json file structure
4. (Optional) Run a real loop: `python3 -m improvement loop --max-iterations 5`
   - Observe progress output
   - Verify stop reason displayed
   - Check history updated

Key behaviors to verify:
- Loop runs unattended (no prompts)
- Each iteration: critic -> apply -> extract -> verify -> commit
- History persists across runs
- Resume continues from specified iteration
  </how-to-verify>
  <resume-signal>Type "approved" if loop works correctly, or describe any issues</resume-signal>
</task>

</tasks>

<verification>
- [ ] `python3 -m improvement loop --max-iterations 3` runs without errors
- [ ] `.improvement-history.json` contains iteration records
- [ ] `python3 -m improvement history` shows formatted table
- [ ] `python3 -m improvement loop --resume-from N` truncates and continues
- [ ] Loop stops correctly when stop condition met
</verification>

<success_criteria>
- Automated loop runs end-to-end without user interaction
- Stop conditions work: target F1, plateau detection, max iterations
- History persists and enables resume from any iteration
- User approves the implementation
</success_criteria>

<output>
After completion, create `.planning/phases/06-automated-improvement-loop/06-03-SUMMARY.md`
</output>
