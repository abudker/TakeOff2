---
phase: 04-multi-domain-extraction
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - .claude/agents/zones-extractor.md
  - .claude/instructions/zones-extractor/instructions.md
  - .claude/instructions/zones-extractor/field-guide.md
  - .claude/agents/windows-extractor.md
  - .claude/instructions/windows-extractor/instructions.md
  - .claude/instructions/windows-extractor/field-guide.md
autonomous: true

must_haves:
  truths:
    - "Zones extractor agent can be invoked via claude --agent zones-extractor"
    - "Windows extractor agent can be invoked via claude --agent windows-extractor"
    - "Zones extractor returns ZoneInfo[] and WallComponent[] JSON"
    - "Windows extractor returns WindowComponent[] JSON"
  artifacts:
    - path: ".claude/agents/zones-extractor.md"
      provides: "Agent definition for zone/wall extraction"
      contains: "zones-extractor"
    - path: ".claude/instructions/zones-extractor/instructions.md"
      provides: "Extraction workflow for zones and walls"
      min_lines: 100
    - path: ".claude/instructions/zones-extractor/field-guide.md"
      provides: "Field-by-field mapping for ZoneInfo and WallComponent"
      min_lines: 200
    - path: ".claude/agents/windows-extractor.md"
      provides: "Agent definition for fenestration extraction"
      contains: "windows-extractor"
    - path: ".claude/instructions/windows-extractor/instructions.md"
      provides: "Extraction workflow for windows"
      min_lines: 100
    - path: ".claude/instructions/windows-extractor/field-guide.md"
      provides: "Field-by-field mapping for WindowComponent"
      min_lines: 150
  key_links:
    - from: ".claude/agents/zones-extractor.md"
      to: ".claude/instructions/zones-extractor/instructions.md"
      via: "@ reference in agent definition"
      pattern: "@.claude/instructions/zones-extractor"
    - from: ".claude/agents/windows-extractor.md"
      to: ".claude/instructions/windows-extractor/instructions.md"
      via: "@ reference in agent definition"
      pattern: "@.claude/instructions/windows-extractor"
---

<objective>
Create zones and windows extractor agents following the thin agent pattern established in Phase 3.

Purpose: These are two of four domain extractors needed for complete building spec extraction. Zones/walls and windows are foundational envelope components that appear on most Title 24 documents.

Output: Two fully functional Claude Code agents (zones-extractor, windows-extractor) with detailed extraction instructions and field guides mapping schema fields to Title 24 document sources.
</objective>

<execution_context>
@/Users/Andrew/.claude/get-shit-done/workflows/execute-plan.md
@/Users/Andrew/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/04-multi-domain-extraction/04-CONTEXT.md
@.planning/phases/04-multi-domain-extraction/04-RESEARCH.md

# Prior work to follow as pattern
@.planning/phases/03-single-domain-extraction/03-02-SUMMARY.md

# Schema definitions
@src/schemas/building_spec.py

# Existing agent pattern to follow
@.claude/agents/project-extractor.md
@.claude/instructions/project-extractor/instructions.md
@.claude/instructions/project-extractor/field-guide.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Zones Extractor Agent</name>
  <files>
    .claude/agents/zones-extractor.md
    .claude/instructions/zones-extractor/instructions.md
    .claude/instructions/zones-extractor/field-guide.md
  </files>
  <action>
Create zones-extractor agent following the thin agent pattern from project-extractor:

**Agent definition (.claude/agents/zones-extractor.md):**
- Name: zones-extractor
- Description: Extracts thermal zones and wall components from Title 24 plans
- Tools: Read
- References: @.claude/instructions/zones-extractor/instructions.md and field-guide.md
- Input: Page images + DocumentMap JSON (same as project-extractor)
- Output: JSON with zones[] and walls[] arrays

**Instructions (.claude/instructions/zones-extractor/instructions.md):**
Cover the extraction workflow:
1. Input reception (page images + document map from orchestrator)
2. Page prioritization (CBECC pages first - have zone summaries, then schedules, then floor plans)
3. Zone identification strategy (look for zone names, floor areas, volumes)
4. Wall component extraction (linked to zones via zone field)
5. Naming conventions (use consistent zone/wall names for deduplication)
6. Data validation before output
7. JSON output format matching schema

**Field guide (.claude/instructions/zones-extractor/field-guide.md):**
Map each field from ZoneInfo and WallComponent to Title 24 document sources:

ZoneInfo fields (12):
- name: Zone name from CBECC zone list, floor plan labels
- zone_type: Conditioned/Unconditioned from CBECC, room schedules
- status: New/Existing/Altered from project scope
- floor_area: CBECC zone summary, floor plan dimensions
- ceiling_height: CBECC zone data, wall schedules, typical 8-10 ft
- stories: Number of floors in zone
- volume: CBECC or calculate from area x height
- exterior_wall_area: CBECC zone summary, wall schedule totals
- exterior_wall_door_area: Door schedules linked to zone
- ceiling_below_attic_area: CBECC ceiling summary
- cathedral_ceiling_area: CBECC ceiling summary
- slab_floor_area: CBECC floor summary

WallComponent fields (11):
- name: Wall identifier (e.g., "N Wall", "Zone 1 - North")
- zone: Parent zone name (critical for linking)
- status: New/Existing/Altered
- construction_type: CBECC wall construction, R-value in name
- orientation: Degrees from CBECC, or cardinal direction from plans
- area: Wall schedule, CBECC wall summary
- window_area: Window schedule totals for this wall
- door_area: Door schedule totals for this wall
- tilt: Usually 90 for vertical walls
- framing_factor: CBECC framing assumptions

For each field include:
- Document sources (prioritized by reliability)
- Common labels and formats in Title 24 docs
- Example values and typical ranges
- Extraction tips and edge cases
  </action>
  <verify>
    - ls -la .claude/agents/zones-extractor.md (exists)
    - ls -la .claude/instructions/zones-extractor/ (directory with 2 files)
    - grep "zones-extractor" .claude/agents/zones-extractor.md (agent name present)
    - grep "@.claude/instructions/zones-extractor" .claude/agents/zones-extractor.md (references instructions)
    - wc -l .claude/instructions/zones-extractor/instructions.md (>100 lines)
    - wc -l .claude/instructions/zones-extractor/field-guide.md (>200 lines)
  </verify>
  <done>
    Zones extractor agent defined with comprehensive field guide covering all 12 ZoneInfo fields and 11 WallComponent fields. Agent follows thin wrapper pattern with @ references to instruction files.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create Windows Extractor Agent</name>
  <files>
    .claude/agents/windows-extractor.md
    .claude/instructions/windows-extractor/instructions.md
    .claude/instructions/windows-extractor/field-guide.md
  </files>
  <action>
Create windows-extractor agent following the same thin agent pattern:

**Agent definition (.claude/agents/windows-extractor.md):**
- Name: windows-extractor
- Description: Extracts fenestration (windows, glazing) from Title 24 plans
- Tools: Read
- References: @.claude/instructions/windows-extractor/instructions.md and field-guide.md
- Input: Page images + DocumentMap JSON
- Output: JSON with windows[] array

**Instructions (.claude/instructions/windows-extractor/instructions.md):**
Cover the extraction workflow:
1. Input reception (page images + document map)
2. Page prioritization (window schedules first, CBECC fenestration section, floor plans for layout)
3. Window identification (from schedules, CBECC lists, plan callouts)
4. Linking windows to walls (use orientation/wall name)
5. Handling window multipliers (same window type, multiple instances)
6. Performance values (U-factor, SHGC from schedules or CBECC)
7. Naming conventions for deduplication
8. JSON output format

**Field guide (.claude/instructions/windows-extractor/field-guide.md):**
Map each WindowComponent field to Title 24 document sources:

WindowComponent fields (11):
- name: Window identifier from schedule (W-1, Window A, etc.)
- wall: Parent wall name - critical for linking, use orientation if not explicit
- status: New/Existing/Altered from project scope
- azimuth: Orientation in degrees, or derive from wall orientation
- height: Window schedule dimensions, typically 4-6 ft
- width: Window schedule dimensions, typically 2-4 ft
- multiplier: How many identical windows (from schedule or plan count)
- area: Calculate from h x w x multiplier, or from schedule total
- u_factor: Window schedule, CBECC fenestration, typically 0.25-0.35
- shgc: Window schedule, CBECC fenestration, typically 0.22-0.25
- exterior_shade: Overhang, awning info from plans/schedules

For each field include:
- Document sources (prioritized)
- Common labels and formats (U-value vs U-factor, etc.)
- Example values and typical ranges for California
- Extraction tips (schedules may list by type, not individual)
  </action>
  <verify>
    - ls -la .claude/agents/windows-extractor.md (exists)
    - ls -la .claude/instructions/windows-extractor/ (directory with 2 files)
    - grep "windows-extractor" .claude/agents/windows-extractor.md (agent name present)
    - grep "@.claude/instructions/windows-extractor" .claude/agents/windows-extractor.md (references instructions)
    - wc -l .claude/instructions/windows-extractor/instructions.md (>100 lines)
    - wc -l .claude/instructions/windows-extractor/field-guide.md (>150 lines)
  </verify>
  <done>
    Windows extractor agent defined with comprehensive field guide covering all 11 WindowComponent fields. Agent follows thin wrapper pattern with @ references to instruction files.
  </done>
</task>

</tasks>

<verification>
After both tasks complete:

1. Agent definitions exist and follow pattern:
   - ls .claude/agents/*.md shows zones-extractor.md and windows-extractor.md
   - Both files reference their instruction directories

2. Instruction files are substantive:
   - zones-extractor instructions: >100 lines
   - zones-extractor field-guide: >200 lines (covers 23 fields)
   - windows-extractor instructions: >100 lines
   - windows-extractor field-guide: >150 lines (covers 11 fields)

3. Field guides cover all schema fields:
   - grep -c "name:" for each field guide shows comprehensive coverage
</verification>

<success_criteria>
- Both agents can be referenced by name in claude --agent command
- Agent definitions are <50 lines (thin wrapper pattern)
- Instructions cover complete extraction workflow
- Field guides map every schema field to document sources
- Pattern matches project-extractor for consistency
</success_criteria>

<output>
After completion, create `.planning/phases/04-multi-domain-extraction/04-01-SUMMARY.md`
</output>
