---
phase: 04-multi-domain-extraction
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - .claude/agents/hvac-extractor.md
  - .claude/instructions/hvac-extractor/instructions.md
  - .claude/instructions/hvac-extractor/field-guide.md
  - .claude/agents/dhw-extractor.md
  - .claude/instructions/dhw-extractor/instructions.md
  - .claude/instructions/dhw-extractor/field-guide.md
autonomous: true

must_haves:
  truths:
    - "HVAC extractor agent can be invoked via claude --agent hvac-extractor"
    - "DHW extractor agent can be invoked via claude --agent dhw-extractor"
    - "HVAC extractor returns HVACSystem[] JSON with heating/cooling/distribution data"
    - "DHW extractor returns WaterHeatingSystem[] JSON with water heater details"
  artifacts:
    - path: ".claude/agents/hvac-extractor.md"
      provides: "Agent definition for HVAC system extraction"
      contains: "hvac-extractor"
    - path: ".claude/instructions/hvac-extractor/instructions.md"
      provides: "Extraction workflow for HVAC systems"
      min_lines: 100
    - path: ".claude/instructions/hvac-extractor/field-guide.md"
      provides: "Field-by-field mapping for HVACSystem and sub-models"
      min_lines: 250
    - path: ".claude/agents/dhw-extractor.md"
      provides: "Agent definition for water heating extraction"
      contains: "dhw-extractor"
    - path: ".claude/instructions/dhw-extractor/instructions.md"
      provides: "Extraction workflow for water heaters"
      min_lines: 80
    - path: ".claude/instructions/dhw-extractor/field-guide.md"
      provides: "Field-by-field mapping for WaterHeatingSystem and WaterHeater"
      min_lines: 150
  key_links:
    - from: ".claude/agents/hvac-extractor.md"
      to: ".claude/instructions/hvac-extractor/instructions.md"
      via: "@ reference in agent definition"
      pattern: "@.claude/instructions/hvac-extractor"
    - from: ".claude/agents/dhw-extractor.md"
      to: ".claude/instructions/dhw-extractor/instructions.md"
      via: "@ reference in agent definition"
      pattern: "@.claude/instructions/dhw-extractor"
---

<objective>
Create HVAC and DHW (water heating) extractor agents following the thin agent pattern.

Purpose: These are the remaining two domain extractors. HVAC systems include heat pumps, furnaces, cooling systems, and duct distribution. DHW covers water heaters (storage, tankless, heat pump types).

Output: Two fully functional Claude Code agents (hvac-extractor, dhw-extractor) with detailed extraction instructions and field guides.
</objective>

<execution_context>
@/Users/Andrew/.claude/get-shit-done/workflows/execute-plan.md
@/Users/Andrew/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/04-multi-domain-extraction/04-CONTEXT.md
@.planning/phases/04-multi-domain-extraction/04-RESEARCH.md

# Prior work to follow as pattern
@.planning/phases/03-single-domain-extraction/03-02-SUMMARY.md

# Schema definitions - focus on HVAC and water heating models
@src/schemas/building_spec.py

# Existing agent pattern to follow
@.claude/agents/project-extractor.md
@.claude/instructions/project-extractor/instructions.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create HVAC Extractor Agent</name>
  <files>
    .claude/agents/hvac-extractor.md
    .claude/instructions/hvac-extractor/instructions.md
    .claude/instructions/hvac-extractor/field-guide.md
  </files>
  <action>
Create hvac-extractor agent following the thin agent pattern:

**Agent definition (.claude/agents/hvac-extractor.md):**
- Name: hvac-extractor
- Description: Extracts HVAC systems (heating, cooling, distribution) from Title 24 plans
- Tools: Read
- References: @.claude/instructions/hvac-extractor/instructions.md and field-guide.md
- Input: Page images + DocumentMap JSON
- Output: JSON with hvac_systems[] array containing HVACSystem objects

**Instructions (.claude/instructions/hvac-extractor/instructions.md):**
Cover the extraction workflow:
1. Input reception (page images + document map)
2. Page prioritization:
   - CBECC mechanical summary (most reliable)
   - CF1R mechanical section
   - Equipment schedules (RTU, heat pump, furnace schedules)
   - Mechanical plans/one-line diagrams
3. System identification (look for system names, zone assignments)
4. Heating system extraction:
   - System type (heat pump, furnace, etc.)
   - Performance ratings (HSPF, capacity at 47F/17F)
   - Auxiliary heating if present
5. Cooling system extraction:
   - System type (split system, package unit, etc.)
   - Performance ratings (SEER2, EER2, CFM/ton)
   - Charge verification status
6. Distribution system extraction:
   - Duct type (in conditioned space, attic, etc.)
   - Leakage percentage
   - Insulation R-value
   - Supply/return sizing
7. Linking HVAC to zones
8. Naming conventions for deduplication
9. JSON output format matching HVACSystem schema

**Field guide (.claude/instructions/hvac-extractor/field-guide.md):**
Map each field to Title 24 document sources:

HVACSystem fields (5):
- name: System identifier from CBECC, equipment schedule
- status: New/Existing/Altered
- system_type: Heat Pump, Furnace, Split System, Package Unit, Ductless, Other
- heating: HeatPumpHeating object (see below)
- cooling: HeatPumpCooling object (see below)
- distribution: DistributionSystem object (see below)

HeatPumpHeating fields (6):
- system_type: SplitHeatPump, PackagedHeatPump, etc.
- hspf: HSPF rating from equipment schedule, CBECC, typical 8-10
- capacity_47: Heating capacity at 47F in Btuh
- capacity_17: Heating capacity at 17F in Btuh
- auxiliary_heating_capacity: Backup electric strip in Btuh
- ducted: True/False

HeatPumpCooling fields (6):
- system_type: SplitHeatPump, PackagedHeatPump, etc.
- seer2: SEER2 rating, typical 14-20
- eer2: EER2 rating
- cfm_per_ton: Airflow per ton, typical 350-450
- ac_charge: Charge verification status
- ducted: True/False

DistributionSystem fields (10):
- name: Duct system name
- system_type: DuctsInAll, DuctsInConditioned, etc.
- percent_leakage: Duct leakage %, typical 4-15%
- insulation_r_value: R-6, R-8 typical for ducts
- supply_area: Supply duct surface area sq ft
- supply_diameter: Supply duct diameter inches
- return_area: Return duct surface area sq ft
- return_diameter: Return duct diameter inches
- bypass_duct: True if present

For each field include:
- Document sources (prioritized)
- Common labels (SEER vs SEER2, HSPF2, etc.)
- Typical California Title 24 ranges
- Extraction tips for complex mechanical schedules
  </action>
  <verify>
    - ls -la .claude/agents/hvac-extractor.md (exists)
    - ls -la .claude/instructions/hvac-extractor/ (directory with 2 files)
    - grep "hvac-extractor" .claude/agents/hvac-extractor.md (agent name present)
    - grep "@.claude/instructions/hvac-extractor" .claude/agents/hvac-extractor.md (references instructions)
    - wc -l .claude/instructions/hvac-extractor/instructions.md (>100 lines)
    - wc -l .claude/instructions/hvac-extractor/field-guide.md (>250 lines - covers 27+ fields)
  </verify>
  <done>
    HVAC extractor agent defined with comprehensive field guide covering HVACSystem, HeatPumpHeating, HeatPumpCooling, and DistributionSystem (27+ fields total). Agent follows thin wrapper pattern.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create DHW Extractor Agent</name>
  <files>
    .claude/agents/dhw-extractor.md
    .claude/instructions/dhw-extractor/instructions.md
    .claude/instructions/dhw-extractor/field-guide.md
  </files>
  <action>
Create dhw-extractor agent (Domestic Hot Water) following the thin agent pattern:

**Agent definition (.claude/agents/dhw-extractor.md):**
- Name: dhw-extractor
- Description: Extracts water heating systems from Title 24 plans
- Tools: Read
- References: @.claude/instructions/dhw-extractor/instructions.md and field-guide.md
- Input: Page images + DocumentMap JSON
- Output: JSON with water_heating_systems[] array containing WaterHeatingSystem objects

**Instructions (.claude/instructions/dhw-extractor/instructions.md):**
Cover the extraction workflow:
1. Input reception (page images + document map)
2. Page prioritization:
   - CBECC DHW section (most reliable)
   - CF1R water heating section
   - Equipment schedules (water heater schedule)
   - Plumbing plans
3. Water heater identification:
   - System name, type (storage, tankless, heat pump)
   - Fuel type (electric, gas, heat pump)
4. Performance data extraction:
   - Tank volume (if storage type)
   - Energy factor (EF or UEF)
   - Input rating and units
   - Recovery efficiency
5. Installation details:
   - Tank location (garage, interior, etc.)
   - Insulation values
6. System grouping (multiple water heaters may serve one system)
7. Naming conventions for deduplication
8. JSON output format matching WaterHeatingSystem schema

**Field guide (.claude/instructions/dhw-extractor/field-guide.md):**
Map each field to Title 24 document sources:

WaterHeatingSystem fields (4):
- name: System name from CBECC, schedule
- status: New/Existing/Altered
- system_type: Central, Point of use, etc.
- water_heaters: Array of WaterHeater objects

WaterHeater fields (14):
- name: Water heater identifier (WH-1, etc.)
- fuel: Electric Resistance, Natural Gas, Heat Pump
- tank_type: Storage, Tankless, Heat Pump, Instantaneous
- volume: Tank gallons (typically 40-80 for storage)
- energy_factor: EF or UEF rating (typically 0.90-3.5 for heat pump)
- input_rating: Input capacity
- input_rating_units: watts, Btuh, kW
- interior_insulation_r_value: Interior R-value
- exterior_insulation_r_value: Exterior blanket R-value if present
- standby_loss: Standby loss value
- tank_location: Garage, Interior, Exterior, etc.
- rated_flow: GPM for tankless
- first_hour_rating: First hour rating (storage tanks)
- recovery_efficiency: Recovery efficiency %

For each field include:
- Document sources (CBECC, schedules, CF1R)
- Common labels (EF vs UEF, different fuel type terms)
- Typical California Title 24 values
- Tips for distinguishing tank types from limited data
  </action>
  <verify>
    - ls -la .claude/agents/dhw-extractor.md (exists)
    - ls -la .claude/instructions/dhw-extractor/ (directory with 2 files)
    - grep "dhw-extractor" .claude/agents/dhw-extractor.md (agent name present)
    - grep "@.claude/instructions/dhw-extractor" .claude/agents/dhw-extractor.md (references instructions)
    - wc -l .claude/instructions/dhw-extractor/instructions.md (>80 lines)
    - wc -l .claude/instructions/dhw-extractor/field-guide.md (>150 lines - covers 18 fields)
  </verify>
  <done>
    DHW extractor agent defined with comprehensive field guide covering WaterHeatingSystem and WaterHeater (18 fields total). Agent follows thin wrapper pattern.
  </done>
</task>

</tasks>

<verification>
After both tasks complete:

1. Agent definitions exist and follow pattern:
   - ls .claude/agents/*.md shows hvac-extractor.md and dhw-extractor.md
   - Both files reference their instruction directories

2. Instruction files are substantive:
   - hvac-extractor instructions: >100 lines
   - hvac-extractor field-guide: >250 lines (covers 27+ HVAC fields)
   - dhw-extractor instructions: >80 lines
   - dhw-extractor field-guide: >150 lines (covers 18 DHW fields)

3. All four domain extractors now exist:
   - ls .claude/agents/*-extractor.md shows: project, zones, windows, hvac, dhw
</verification>

<success_criteria>
- Both agents can be referenced by name in claude --agent command
- Agent definitions are <50 lines (thin wrapper pattern)
- Instructions cover complete extraction workflow including mechanical-specific concerns
- Field guides map every schema field to document sources
- HVAC covers heating, cooling, and distribution subsystems
- DHW covers both system-level and individual water heater fields
</success_criteria>

<output>
After completion, create `.planning/phases/04-multi-domain-extraction/04-02-SUMMARY.md`
</output>
